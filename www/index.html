<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
    <!-- This is a wide open CSP declaration. To lock this down for production, see below. -->
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline'; style-src 'self' 'unsafe-inline'; media-src *" />
    <!-- Good default declaration:
    * gap: is required only on iOS (when using UIWebView) and is needed for JS->native communication
    * https://ssl.gstatic.com is required only on Android and is needed for TalkBack to function properly
    * Disables use of eval() and inline scripts in order to mitigate risk of XSS vulnerabilities. To change this:
        * Enable inline JS: add 'unsafe-inline' to default-src
        * Enable eval(): add 'unsafe-eval' to default-src
    * Create your own at http://cspisawesome.com
    -->
    <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: 'unsafe-inline' https://ssl.gstatic.com; style-src 'self' 'unsafe-inline'; media-src *" /> -->

 
	<script type="text/javascript" src="js/index.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css">
      <script src="js/jquery-1.11.1.min.js"></script>
      <script src="http://code.highcharts.com/adapters/standalone-framework.js"></script>
 <script src="http://code.highcharts.com/stock/highstock.js"></script>
  <script src="http://code.highcharts.com/modules/exporting.js"></script>
    <script src="js/bootstrap.min.js"></script>
    
    <script type="text/javascript">
        app.initialize();
		
		var mesesArr = new Array();
		var anioArr = new Array();//['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun','Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
		
		$(function() {
		
		var rpe 	= $("#rpe");
		var pass 	= $("#pass");
		var medidor = $("#medidor");
		var i=0;
		
		
		
		$("#verificar").on("click",function(){
		//$("#h1id").text("click");
			event.preventDefault();
			$("#tbody").empty();
			//alert("medidor: "+$("#medidor").val());
			
			
				$.ajax({ 
					type: 'GET', 
					url: 'http://www2.da0.cfemex.com//portal/phoneGap/consumoHistoricoSicom_json.php?medidor='+medidor.val(), 
					 success: function (result) { 
					  
					 	$.each(result.lista, function(i, field){
					 
							 $("#tbody").append("<tr><td class=\"title\">"+field.rpuTmp+"</td><td>"+(field.anio +'-'+ field.mes)+"</td><td>"+field.consumokwh+"</td><td>$ "+field.total+"</td></tr>");
					 
						});
					 
					}
					,error: function()
					{
						alert("error");
						}
				});
				
				
				
				
				$.getJSON('http://www2.da0.cfemex.com/portal/phoneGap/consumoHistoricoSicom_json.php?callback=?&opt=arr&medidor='+medidor.val(), function (data) {
        // Create the chart
        $('#grafcontainer').highcharts('StockChart', {


            

            title : {
                text : 'Consumo Medidor'
            },
			plotOptions: {
				line: {
					dataLabels: {
						enabled: true
					} 
				}
			},
				rangeSelector: {
					enabled: false
				},
			  series : [{
                name : 'KWH',
                data : data.graf,
                tooltip: {
                    valueDecimals: 2
                },marker : {
                    enabled : true,
                    radius : 3
                }
            }]
        });
    });

				$("#graf").tab('show');
				
			
			 
			});
			
			
		 
			
		$("#grafcontainer").addClass("img-responsive");	
			
			var onSuccessgeo = function(position) {
        alert('Latitude: '          + position.coords.latitude          + '\n' +
              'Longitude: '         + position.coords.longitude         + '\n' +
              'Altitude: '          + position.coords.altitude          + '\n' +
              'Accuracy: '          + position.coords.accuracy          + '\n' +
              'Altitude Accuracy: ' + position.coords.altitudeAccuracy  + '\n' +
              'Heading: '           + position.coords.heading           + '\n' +
              'Speed: '             + position.coords.speed             + '\n' +
              'Timestamp: '         + position.timestamp                + '\n');
    };

    // onError Callback receives a PositionError object
    //
    function onError(error) {
        alert('code: '    + error.code    + '\n' +
              'message: ' + error.message + '\n');
    }

	
	$("#locationbtn").on("click",function(){
    navigator.geolocation.getCurrentPosition(onSuccessgeo, onError);
	});
	
			
			
		});
    </script>
				

    <title>Consumo de Medidores</title>
 


</head>
<body>

<div class="container">
<br>
<br>
  <div class="panel panel-primary">
      <div class="panel-heading">Consumo KWH de Clientes</div>
      <div class="panel-body">
  <ul class="nav nav-pills">
    <li class="active"><a id="#home" data-toggle="pill" href="#home">Entrar</a></li>
    <li><a id="graf" data-toggle="pill" href="#grafica">Grafica</a></li>
    <li><a id="list" data-toggle="pill" href="#listado">Listado</a></li>
  </ul>
  
  <div class="tab-content">
  
    <div id="home" class="tab-pane fade in active">
      <form>
        <div class="panel panel-default">
      <div class="panel-heading">Proporcionar usuario y contraseña</div>
      <div class="panel-body">
			<table width="100%" border="0">
           <!-- <tr>
            	<td colspan="2"  width="100%" align="center"><h3>Proporcionar usuario y contraseña</h3></td>
            </tr>-->
             <tr>
            <td align="left" width="20%">
            	<label for="rpe" class="ui-hidden-accessible">Usuario:</label>
                </td>
                <td align="left"  width="80%">
                <input type="text" size="10" name="rpe" id="rpe" value="" placeholder="Rpe" data-theme="a">
    		</td>
            </tr>
            <tr>
                <td align="left" width="20%">
                    <label for="pass" class="ui-hidden-accessible">Password:</label>
                    </td>
                	<td align="left"  width="80%">
                    <input type="password" size="10" name="pass" id="pass" value="" placeholder="Contraseña" data-theme="a">
                </td>
            </tr>
            <tr>
               <td align="left" width="20%">
                    <label for="medidor" class="ui-hidden-accessible">Medidor:</label>
                    </td>
                	<td align="left"  width="80%">
                    <input type="text" size="10" name="medidor" id="medidor" value="6RE574" placeholder="medidor" data-theme="a">
                </td>
            </tr>
                
    		<tr>
                <td colspan="2"   width="100%" align="center">
                    <button type="submit" id="verificar" class="ui-btn ui-corner-all ui-shadow ui-btn-b ui-btn-icon-left ui-icon-check">Verificar</button>&nbsp;
                     <button type="button" id="locationbtn" class="ui-btn ui-corner-all ui-shadow ui-btn-b ui-btn-icon-left ui-icon-check">location</button>
                    
                    
                </td>
            </tr>
              
		</table>
        </div>
    </div>
    </form>      
    </div>
    <div id="grafica" class="tab-pane fade">
       <div id="grafcontainer">
          </div>
    </div>
    <div id="listado" class="tab-pane fade table-responsive">
      <table class="table table-striped table-bordered">
          <thead>
            <tr>
              <th width="31%">&nbsp;Rpu</th>
              <th width="19%">Fecha</th>
              <th width="17%">Kwh</th>
              <th width="33%">Total</th>
            </tr>
          </thead>
          <tbody id="tbody">
          </tbody>
    </table>
    </div>
    
    </div>
    </div>
  </div>
</div>
</body>

<script>

</script>
</html>


