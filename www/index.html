<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
    <!-- This is a wide open CSP declaration. To lock this down for production, see below. -->
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline'; style-src 'self' 'unsafe-inline'; media-src *" />
    <!-- Good default declaration:
    * gap: is required only on iOS (when using UIWebView) and is needed for JS->native communication
    * https://ssl.gstatic.com is required only on Android and is needed for TalkBack to function properly
    * Disables use of eval() and inline scripts in order to mitigate risk of XSS vulnerabilities. To change this:
        * Enable inline JS: add 'unsafe-inline' to default-src
        * Enable eval(): add 'unsafe-eval' to default-src
    * Create your own at http://cspisawesome.com
    -->
    <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: 'unsafe-inline' https://ssl.gstatic.com; style-src 'self' 'unsafe-inline'; media-src *" /> -->

 
	<script type="text/javascript" src="js/index.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css">
      <script src="js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="js/highcharts.js"></script>
	<script src="js/exporting.js"></script>
    <script src="js/bootstrap.min.js"></script>
    
    <script type="text/javascript">
        app.initialize();
		
		var mesesArr = new Array();
		var anioArr = new Array();//['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun','Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
		
		$(function() {
		
		var rpe 	= $("#rpe");
		var pass 	= $("#pass");
		var medidor = $("#medidor");
		var i=0;
		
		$("#verificar").on("click",function(){
		//$("#h1id").text("click");
			event.preventDefault();
			$("#tbody").empty();
			//alert("medidor: "+$("#medidor").val());
			$("#list").tab('show');
			
				$.ajax({ 
					type: 'GET', 
					url: 'http://10.6.2.103/portal/phoneGap/consumoHistoricoSicom_json.php?medidor='+medidor.val(), 
					 success: function (result) { 
					 	$.each(result, function(i, field){
							
							if(!$.inArray( (field.mes +1), mesesArr ) )
							{ mesesArr.push((field.mes +1));}
							
							if(!$.inArray( (field.anio), anioArr ) )
							{ anioArr.push((field.anio));}
							
					 
						 $("#tbody").append("<tr><td class=\"title\">"+field.rpuTmp+"</td><td>"+(field.anio +'-'+ field.mes)+"</td><td>"+field.consumokwh+"</td><td>$ "+field.total+"</td></tr>");
					 
						});
					 
					}
					,error: function()
					{
						alert("error");
						}
				});
	
		
			/*$.getJSON("http://10.6.2.103/portal/phoneGap/consumoHistoricoSicom_json.php?medidor="+medidor.val(), function(result){
				$("#tbody").empty();
				$.each(result, function(i, field){
					 
					 $("#tbody").append("<tr><th>"+field.rpuTmp+"</th><td class=\"title\">"+field.desde+"</td><td>"+field.hasta+"</td><td>"+field.consumokwh+"</td><td>$ "+field.total+"</td></tr>");
					 
				});
				$("#popupLogin").popup("close");
				
			});		*/	
			 
			});
			
			
			
			
			 
                var datos =[7.0, 55, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6];
    $('#grafcontainer').highcharts({
		credits: {
            enabled: true,
            href:"http://www.da0.cfemex.com/portal",
            text:"Cfe- DDBC- DDTI- GVS"
        },
        title: {
            text: '',
            x: -20 //center
        },
        subtitle: {
            text: 'Consumo Mensual por año',
            x: -20
        },
        xAxis: {
            categories: mesesArr
        },
        yAxis: {
            title: {
                text: 'Consumo (Kwh)'
            },
            plotLines: [{
                value: 0,
                width: 1,
                color: '#808080'
            }]
        },
        tooltip: {
            valueSuffix: ' Kwh'
        },
        legend: {
            layout: 'vertical',
            align: 'right',
            verticalAlign: 'middle',
            borderWidth: 0
        },
        series: [{
            name: '2016',
            data: datos
        }, {
            name: 'New York',
            data: [-0.2, 0.8, 5.7, 11.3, 17.0, 22.0, 24.8, 24.1, 20.1, 14.1, 8.6, 2.5]
        }, {
            name: 'Berlin',
            data: [-0.9, 0.6, 3.5, 8.4, 13.5, 17.0, 18.6, 17.9, 14.3, 9.0, 3.9, 1.0]
        }, {
            name: 'London',
            data: [3.9, 4.2, 5.7, 8.5, 11.9, 15.2, 17.0, 16.6, 14.2, 10.3, 6.6, 4.8]
        }]
    });
			
			
			
			var onSuccessgeo = function(position) {
        alert('Latitude: '          + position.coords.latitude          + '\n' +
              'Longitude: '         + position.coords.longitude         + '\n' +
              'Altitude: '          + position.coords.altitude          + '\n' +
              'Accuracy: '          + position.coords.accuracy          + '\n' +
              'Altitude Accuracy: ' + position.coords.altitudeAccuracy  + '\n' +
              'Heading: '           + position.coords.heading           + '\n' +
              'Speed: '             + position.coords.speed             + '\n' +
              'Timestamp: '         + position.timestamp                + '\n');
    };

    // onError Callback receives a PositionError object
    //
    function onError(error) {
        alert('code: '    + error.code    + '\n' +
              'message: ' + error.message + '\n');
    }

	
	$("#locationbtn").on("click",function(){
    navigator.geolocation.getCurrentPosition(onSuccessgeo, onError);
	});
	
			
			
		});
    </script>
				

    <title>Consumo de Medidores</title>
 


</head>
<body>

<div class="container">
<br>
<br>
  <div class="panel panel-primary">
      <div class="panel-heading">Consumo KWH de Clientes</div>
      <div class="panel-body">
  <ul class="nav nav-pills">
    <li class="active"><a id="#home" data-toggle="pill" href="#home">Entrar</a></li>
    <li><a id="graf" data-toggle="pill" href="#grafica">Grafica</a></li>
    <li><a id="list" data-toggle="pill" href="#listado">Listado</a></li>
  </ul>
  
  <div class="tab-content">
  
    <div id="home" class="tab-pane fade in active">
      <form>
        <div class="panel panel-default">
      <div class="panel-heading">Proporcionar usuario y contraseña</div>
      <div class="panel-body">
			<table width="100%" border="0">
           <!-- <tr>
            	<td colspan="2"  width="100%" align="center"><h3>Proporcionar usuario y contraseña</h3></td>
            </tr>-->
             <tr>
            <td align="left" width="20%">
            	<label for="rpe" class="ui-hidden-accessible">Usuario:</label>
                </td>
                <td align="left"  width="80%">
                <input type="text" size="10" name="rpe" id="rpe" value="" placeholder="Rpe" data-theme="a">
    		</td>
            </tr>
            <tr>
                <td align="left" width="20%">
                    <label for="pass" class="ui-hidden-accessible">Password:</label>
                    </td>
                	<td align="left"  width="80%">
                    <input type="password" size="10" name="pass" id="pass" value="" placeholder="Contraseña" data-theme="a">
                </td>
            </tr>
            <tr>
               <td align="left" width="20%">
                    <label for="medidor" class="ui-hidden-accessible">Medidor:</label>
                    </td>
                	<td align="left"  width="80%">
                    <input type="text" size="10" name="medidor" id="medidor" value="6RE574" placeholder="medidor" data-theme="a">
                </td>
            </tr>
                
    		<tr>
                <td colspan="2"   width="100%" align="center">
                    <button type="submit" id="verificar" class="ui-btn ui-corner-all ui-shadow ui-btn-b ui-btn-icon-left ui-icon-check">Verificar</button>&nbsp;
                     <button type="button" id="locationbtn" class="ui-btn ui-corner-all ui-shadow ui-btn-b ui-btn-icon-left ui-icon-check">location</button>
                    
                    
                </td>
            </tr>
              
		</table>
        </div>
    </div>
    </form>      
    </div>
    <div id="grafica" class="tab-pane fade">
       <div id="grafcontainer" class="img-responsive">
          </div>
    </div>
    <div id="listado" class="tab-pane fade table-responsive">
      <table class="table table-striped table-bordered">
          <thead>
            <tr>
              <th width="31%">&nbsp;Rpu</th>
              <th width="19%">Fecha</th>
              <th width="17%">Kwh</th>
              <th width="33%">Total</th>
            </tr>
          </thead>
          <tbody id="tbody">
          </tbody>
    </table>
    </div>
    
    </div>
    </div>
  </div>
</div>
</body>

<script>

</script>
</html>


